<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokemon Event BTÜ</title>
    <style>
      #en-yuksek-liste{
        position: absolute;
        top: 1%;
        left: 1%;
        list-style: none;
        font-size: 1rem;
        background-color: rgba(255, 255, 255, 0.7);
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden">
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <ul id="en-yuksek-liste"></ul>
    <a-scene arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
      <!-- 10 değerine sahip bir barkod için içerik -->
      <a-marker type="barcode" value="5" name="charmander">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="0 0 0"
          obj-model="obj: url(pokemons/charmander/charmander.obj); mtl: url(pokemons/charmander/charmander.mtl);"
        ></a-entity>
      </a-marker>

      <a-marker type="barcode" value="10" name="pikachu">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/pikachu/pikachu.obj); mtl: url(pokemons/pikachu/pikachu.mtl);"
        ></a-entity>
      </a-marker>

      <a-marker type="barcode" value="21" name="tangle">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-gltf-model
          position="0 0.5 0"
          scale="0.5 0.5 0.5"
          rotation="0 0 0"
          src="url(pokemons/tangela/scene.gltf)"
        ></a-gltf-model>
      </a-marker>

      <a-marker type="barcode" value="22" name="diglett">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/diglett/diglett.obj); mtl: url(pokemons/diglett/diglett.mtl);"
        ></a-entity>
      </a-marker>

      <a-marker type="barcode" value="23" name="marill">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/marill/marill.obj); mtl: url(pokemons/marill/marill.mtl);"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="24" name="cubone">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/cubone/cubone.obj); mtl: url(pokemons/cubone/cubone.mtl);"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="31" name="jigglypuff">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/jigglypuff/model.obj); mtl: url(pokemons/jigglypuff/materials.mtl);"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="32" name="eevee">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/eevee/model.obj); mtl: url(pokemons/eevee/materials.mtl);"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="33" name="haunter">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/haunter/model.obj); mtl: url(pokemons/haunter/materials.mtl);"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="34" name="magnemite">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/magnemite/model.obj); mtl: url(pokemons/magnemite/materials.mtl);"
        ></a-entity>
      </a-marker>
      <a-marker type="barcode" value="35" name="porygon">
        <!-- .obj dosyasını görüntülemek için a-entity kullanın -->
        <a-entity
          position="0 0.5 0"
          scale="1 1 1"
          rotation="1 0 0"
          obj-model="obj: url(pokemons/porygon/model.obj); mtl: url(pokemons/porygon/materials.mtl);"
        ></a-entity>
      </a-marker>
      
      <a-entity camera> </a-entity>
    </a-scene>
    <script>
axios.get("https://btu-pokemon-api.onrender.com/en-yuksek-yakalama-oranlari")
  .then((response) => {
    const enYuksekOranlar = response.data;
    
    // Sonuçları ekranda göster
    const listeElementi = document.getElementById("en-yuksek-liste");
    enYuksekOranlar.forEach((kullanici, index) => {
      const yakalananPokemonlar = JSON.parse(kullanici.yakalananPokemonlar); // JSON veriyi diziye çevir
      const listItem = document.createElement("li");
      listItem.textContent = `${index + 1}. ${kullanici.nickname} - Yakalanan Pokemon Sayısı: ${yakalananPokemonlar.length}`;
      listeElementi.appendChild(listItem);
    });
  })
  .catch((error) => {
    console.error("Hata:", error);
  });


  const ogrenciNo = localStorage.getItem("ogrenciNo");
if (ogrenciNo) {
  console.log("Kullanıcı Öğrenci No:", ogrenciNo);
} else {
  const ogrenciNo = prompt("Lütfen öğrenci numaranızı girin:");
  ogrenciNo = ogrenciNo.toString();
  if (ogrenciNo) {
    console.log(ogrenciNo)
    // Sunucuya öğrenci numarasını doğrulama için GET isteği gönder
    fetch(`https://btu-pokemon-api.onrender.com/giris?ogrenciNo=${ogrenciNo}`)
      .then((response) => {
        if (response.status === 200) {
          localStorage.setItem("ogrenciNo", ogrenciNo);
        } else if (response.status === 401) {
          alert("Bu öğrenci numarası sisteme kayıtlı değil. Lütfen siteyi yenileyerek geçerli bir öğrenci numarası girin. Aksi takdirde gelişiminiz kayıt dışı olacaktır ");
        } else {
          alert("Bilinmeyen bir hata oluştu.");
        }
      })
      .catch((error) => {
        console.error("Sunucu hatası:", error);
        alert("Sunucu hatası oluştu. Lütfen daha sonra tekrar deneyin.");
      });
  } else {
    alert("Öğrenci numarası girmediniz . Siteyi yenileyip tekrardan girmediğiniz takdirde gelişiminiz kayıt dışı olacaktır ");
  }
}

      function handleBarcodeDetection(event) {
        const pokemonName = event.target.getAttribute("name");
        console.log(pokemonName);
        const xhr = new XMLHttpRequest();
        // Yakalanan pokemonun adını ve kullanıcının öğrenci numarasını API'ye gönderin
        xhr.open(
    "GET",
    `https://btu-pokemon-api.onrender.com/pokemon-ekle?ogrenciNo=${ogrenciNo}&yeniPokemon=${pokemonName}`,
    true
  );

  xhr.onload = function () {
    if (xhr.status === 200) {
      // Başarı mesajını işle
      const response = JSON.parse(xhr.responseText);
    }
  };

  xhr.send();}
      const barcodeMarkers = document.querySelectorAll(
        'a-marker[type="barcode"]'
      );
      barcodeMarkers.forEach((marker) => {
        marker.addEventListener("markerFound", handleBarcodeDetection);
      });
    </script>
  </body>
</html>
